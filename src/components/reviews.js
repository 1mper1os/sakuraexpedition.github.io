// reviews.js
import reviewsData from "./../jsons/reviews.json";
import "./../css/reviews.css";

// Función para obtener la estructura HTML base
export function getReviewsHTML() {
  return `
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16">
      <h2 class="text-center text-4xl font-extrabold text-[#aa252e] mb-2">¿Por qué elegir a Sakura Expedition?</h2>
      <div class="mx-auto divider6"></div>

      <div class="flex flex-wrap justify-center gap-6 my-8">
        <div class="review-source active" data-source="tripadvisor">
          <strong>(25)</strong> <span>Reseñas positivas</span><br/>
          <svg xmlns="http://www.w3.org/2000/svg" id="Capa_1" data-name="Capa 1" viewBox="0 0 325 325">
            <path d="M174.57,238.53v-14.06h8.81v46.17c-3.18-.68-6.72,1.65-9.5-2.01-9.91,4.15-18.17,2.68-23.53-4.41-4.95-6.54-4.85-15.44,.25-21.89,5.34-6.76,13.66-8.21,23.96-3.8m-9.19,24.33c5.08-.09,9.21-4.33,9.21-9.42-.01-5.25-4.37-9.51-9.61-9.41-5.04,.1-9.27,4.41-9.25,9.42,.02,5.18,4.44,9.51,9.65,9.41"/>
            <path d="M67,236.13c3.11,1.31,6.76-1.76,9.07,2.26,9.81-4.28,18-2.91,23.53,3.99,4.85,6.04,5.12,14.96,.66,21.3-5.26,7.48-13.14,9.06-24.65,4.79v11.85h-8.62v-44.19Zm27.38,17.24c-.05-5.14-4.17-9.3-9.27-9.34-5.22-.04-9.63,4.33-9.58,9.49,.05,5.16,4.55,9.48,9.74,9.34,5.12-.14,9.16-4.35,9.11-9.49"/>
            <path d="M133.66,238.42c2.49-3.86,6.03-1.25,9.24-2.04v34.31c-3.22-.86-6.8,1.83-9.15-2.11-10.6,4.23-18.76,2.59-24.05-4.82-4.77-6.67-4.38-15.38,.96-21.84,5.35-6.46,13.81-7.8,23.01-3.5m-8.74,24.44c5.17-.02,9.5-4.44,9.38-9.58-.11-5.05-4.3-9.2-9.33-9.25-5.21-.06-9.57,4.22-9.58,9.39-.01,5.14,4.35,9.48,9.53,9.45"/>
            <path d="M284.05,271.11c-9.74,.06-17.6-7.63-17.75-17.38-.15-9.96,7.63-17.92,17.54-17.95,9.85-.03,17.99,8.05,17.88,17.75-.11,9.72-7.95,17.52-17.67,17.59m.05-8.25c5.14-.06,9.54-4.6,9.38-9.65-.17-4.96-4.5-9.16-9.48-9.19-5.24-.03-9.46,4.22-9.44,9.47,.02,5.24,4.31,9.44,9.55,9.37"/>
            <polygon points="12.49 232.2 .44 232.2 .44 224.38 33.66 224.38 33.66 232.11 21.62 232.11 21.62 270.33 12.49 270.33 12.49 232.2"/>
            <path d="M236.75,258.89c2.24,0,4.35-.16,6.42,.08,.86,.1,2.03,.89,2.35,1.66,1.1,2.7,3.23,3.62,5.7,3.09,1.45-.32,3.47-1.63,3.72-2.81,.23-1.06-1.35-3.14-2.62-3.75-2.55-1.22-5.47-1.67-8.18-2.6-4.55-1.55-6.82-4.53-6.84-8.74-.02-4.12,2.23-7.76,6.68-8.84,3.5-.85,7.42-1.01,10.96-.39,4.98,.87,7.06,3.93,7.72,9.7-3.32-.48-6.91,1.88-9.53-2.44-.59-.96-3.16-1.1-4.75-.94-.94,.09-2.34,1.42-2.44,2.32-.1,.86,1.02,2.35,1.95,2.74,2.63,1.09,5.45,1.73,8.18,2.6,5.07,1.6,7.45,4.26,7.68,8.5,.25,4.71-2.2,8.74-6.71,10.66-4.86,2.07-9.79,2.02-14.46-.47-3.89-2.07-6.05-5.39-5.84-10.38"/>
            <path d="M203.86,259.49c1.96-6.26,4.11-12.48,5.82-18.8,.89-3.29,2.29-4.98,5.88-4.33,1.44,.26,2.95,.04,4.93,.04-.68,2.06-1.21,3.68-1.76,5.28-3,8.7-6.07,17.38-8.95,26.12-.69,2.12-1.68,2.88-3.94,2.88-7.76,0-7.75,.09-10.21-7.19-2.99-8.83-6-17.65-9.21-27.08,2.87,0,5.45-.25,7.92,.13,.91,.14,1.97,1.62,2.33,2.7,2.24,6.72,4.3,13.5,6.42,20.27,.26,0,.51-.01,.77-.02"/>
            <path d="M29.74,236.15c3.23,1.31,7.28-2.08,8.96,1.97,3.39-.78,6.64-1.52,10.32-2.36v8.91c-1.6,0-3.18-.07-4.74,.01-4.2,.22-5.79,1.83-5.83,6.05-.06,6.45-.02,12.91-.02,19.62h-8.68v-34.21Z"/>
            <path d="M305.68,270.36v-33.36c5.82-1.54,8.3-.96,8.93,1.39,3.3-.87,6.61-1.73,10.39-2.72v8.51c-.41,.19-.62,.36-.84,.38q-9.65,.79-9.65,10.62v15.18h-8.83Z"/>
            <rect x="224.14" y="236.57" width="8.54" height="33.85"/>
            <rect x="53.07" y="236.72" width="8.58" height="33.65"/>
            <path d="M57.52,222.93c2.98,.09,5.38,2.7,5.23,5.69-.15,3.02-2.66,5.19-5.82,5.02-2.94-.15-5.05-2.46-4.98-5.44,.08-3.16,2.41-5.36,5.57-5.27"/>
            <path d="M228.6,233.64c-3.22,.05-5.47-2.12-5.46-5.29,.01-3.16,2.31-5.47,5.4-5.42,3.02,.04,5.15,2.14,5.25,5.17,.11,3.24-2,5.49-5.19,5.55"/>
            <path d="M269,73.44l-15.71,18.89c-.65,3.23,9.22,13.71,11.28,18.38,19.42,44.07-20.94,92.18-67.52,76.39-8.23-2.79-13.68-8.39-21-10.62l-16.2,17.62-17.99-17.6c-59.39,44.69-122.28-29.29-75.37-84.17l-15.79-18.89h39.94c1.03,0,14.04-9.44,17.44-10.96,31.08-13.92,68.01-14.14,99.45-1.21,4.59,1.88,20.31,12.17,21.55,12.17h39.93Zm-71,3.58c-24.98-9.47-53.52-10.04-78.08,.85,19.53,9.76,34.95,25.26,39.93,47.06,5.62-24.18,16.88-31.75,35.88-43.96,1.73-1.11,3.17,.19,2.28-3.95m-55.88,57.5c0-20.6-16.7-37.31-37.31-37.31s-37.3,16.7-37.3,37.31,16.7,37.31,37.3,37.31,37.31-16.7,37.31-37.31m109.87-.04c0-20.63-16.72-37.35-37.35-37.35s-37.35,16.72-37.35,37.35,16.72,37.35,37.35,37.35,37.35-16.72,37.35-37.35"/>
            <path d="M225.06,133.2c0,10.71-8.68,19.39-19.38,19.39s-19.39-8.68-19.39-19.39,8.68-19.38,19.39-19.38,19.38,8.68,19.38,19.38"/>
            <path d="M114.97,133.22c0,10.73-8.7,19.43-19.43,19.43s-19.43-8.7-19.43-19.43,8.7-19.43,19.43-19.43,19.43,8.7,19.43,19.43"/>
          </svg>
        </div>
        <div class="review-source" data-source="google">
          <strong>(25)</strong> <span>Reseñas positivas</span><br/>
          <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo" width="40">
        </div>
        <div class="review-source" data-source="facebook">
          <strong>(25)</strong> <span>Reseñas positivas</span><br/>
          <img src="https://upload.wikimedia.org/wikipedia/commons/5/51/Facebook_f_logo_%282019%29.svg" alt="Facebook Logo" width="40">
        </div>
      </div>

      <div id="reviews-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <!-- Reviews will be loaded here dynamically -->
      </div>
    </div>
  `;
}

// Función para crear una tarjeta de reseña individual
function createReviewCard(review, index) {
  const truncatedText = review.text.length > 120 ? review.text.substring(0, 120) + '...' : review.text;
  
  return `
    <div class="review-card animate-fade-in" style="animation-delay: ${index * 0.1}s;">
      <div class="review-author-avatar">
        <img src="${review.profileImage}" alt="${review.name}">
      </div>
      <div class="review-source-logo" data-source-logo="${review.source.toLowerCase()}">
        ${review.logo}
      </div>

      <h3 class="review-author-name">${review.name}</h3>
      <div class="review-rating-stars">★★★★★</div>
      <p class="review-title">${review.reviewTitle}</p>
      <p class="review-text-content">
        ${truncatedText}
        ${review.text.length > 120 ? `<a href="#" class="read-more-link" data-full-text="${encodeURIComponent(review.text)}">Read more</a>` : ''}
      </p>
    </div>
  `;
}

// Función para obtener los SVGs de logos
function getLogos() {
  return {
    tripadvisor: `
      <svg xmlns="http://www.w3.org/2000/svg" id="Capa_1" data-name="Capa 1" viewBox="0 0 325 325">
        <path d="M174.57,238.53v-14.06h8.81v46.17c-3.18-.68-6.72,1.65-9.5-2.01-9.91,4.15-18.17,2.68-23.53-4.41-4.95-6.54-4.85-15.44,.25-21.89,5.34-6.76,13.66-8.21,23.96-3.8m-9.19,24.33c5.08-.09,9.21-4.33,9.21-9.42-.01-5.25-4.37-9.51-9.61-9.41-5.04,.1-9.27,4.41-9.25,9.42,.02,5.18,4.44,9.51,9.65,9.41"/>
        <path d="M67,236.13c3.11,1.31,6.76-1.76,9.07,2.26,9.81-4.28,18-2.91,23.53,3.99,4.85,6.04,5.12,14.96,.66,21.3-5.26,7.48-13.14,9.06-24.65,4.79v11.85h-8.62v-44.19Zm27.38,17.24c-.05-5.14-4.17-9.3-9.27-9.34-5.22-.04-9.63,4.33-9.58,9.49,.05,5.16,4.55,9.48,9.74,9.34,5.12-.14,9.16-4.35,9.11-9.49"/>
        <path d="M133.66,238.42c2.49-3.86,6.03-1.25,9.24-2.04v34.31c-3.22-.86-6.8,1.83-9.15-2.11-10.6,4.23-18.76,2.59-24.05-4.82-4.77-6.67-4.38-15.38,.96-21.84,5.35-6.46,13.81-7.8,23.01-3.5m-8.74,24.44c5.17-.02,9.5-4.44,9.38-9.58-.11-5.05-4.3-9.2-9.33-9.25-5.21-.06-9.57,4.22-9.58,9.39-.01,5.14,4.35,9.48,9.53,9.45"/>
        <path d="M284.05,271.11c-9.74,.06-17.6-7.63-17.75-17.38-.15-9.96,7.63-17.92,17.54-17.95,9.85-.03,17.99,8.05,17.88,17.75-.11,9.72-7.95,17.52-17.67,17.59m.05-8.25c5.14-.06,9.54-4.6,9.38-9.65-.17-4.96-4.5-9.16-9.48-9.19-5.24-.03-9.46,4.22-9.44,9.47,.02,5.24,4.31,9.44,9.55,9.37"/>
        <polygon points="12.49 232.2 .44 232.2 .44 224.38 33.66 224.38 33.66 232.11 21.62 232.11 21.62 270.33 12.49 270.33 12.49 232.2"/>
        <path d="M236.75,258.89c2.24,0,4.35-.16,6.42,.08,.86,.1,2.03,.89,2.35,1.66,1.1,2.7,3.23,3.62,5.7,3.09,1.45-.32,3.47-1.63,3.72-2.81,.23-1.06-1.35-3.14-2.62-3.75-2.55-1.22-5.47-1.67-8.18-2.6-4.55-1.55-6.82-4.53-6.84-8.74-.02-4.12,2.23-7.76,6.68-8.84,3.5-.85,7.42-1.01,10.96-.39,4.98,.87,7.06,3.93,7.72,9.7-3.32-.48-6.91,1.88-9.53-2.44-.59-.96-3.16-1.1-4.75-.94-.94,.09-2.34,1.42-2.44,2.32-.1,.86,1.02,2.35,1.95,2.74,2.63,1.09,5.45,1.73,8.18,2.6,5.07,1.6,7.45,4.26,7.68,8.5,.25,4.71-2.2,8.74-6.71,10.66-4.86,2.07-9.79,2.02-14.46-.47-3.89-2.07-6.05-5.39-5.84-10.38"/>
        <path d="M203.86,259.49c1.96-6.26,4.11-12.48,5.82-18.8,.89-3.29,2.29-4.98,5.88-4.33,1.44,.26,2.95,.04,4.93,.04-.68,2.06-1.21,3.68-1.76,5.28-3,8.7-6.07,17.38-8.95,26.12-.69,2.12-1.68,2.88-3.94,2.88-7.76,0-7.75,.09-10.21-7.19-2.99-8.83-6-17.65-9.21-27.08,2.87,0,5.45-.25,7.92,.13,.91,.14,1.97,1.62,2.33,2.7,2.24,6.72,4.3,13.5,6.42,20.27,.26,0,.51-.01,.77-.02"/>
        <path d="M29.74,236.15c3.23,1.31,7.28-2.08,8.96,1.97,3.39-.78,6.64-1.52,10.32-2.36v8.91c-1.6,0-3.18-.07-4.74,.01-4.2,.22-5.79,1.83-5.83,6.05-.06,6.45-.02,12.91-.02,19.62h-8.68v-34.21Z"/>
        <path d="M305.68,270.36v-33.36c5.82-1.54,8.3-.96,8.93,1.39,3.3-.87,6.61-1.73,10.39-2.72v8.51c-.41,.19-.62,.36-.84,.38q-9.65,.79-9.65,10.62v15.18h-8.83Z"/>
        <rect x="224.14" y="236.57" width="8.54" height="33.85"/>
        <rect x="53.07" y="236.72" width="8.58" height="33.65"/>
        <path d="M57.52,222.93c2.98,.09,5.38,2.7,5.23,5.69-.15,3.02-2.66,5.19-5.82,5.02-2.94-.15-5.05-2.46-4.98-5.44,.08-3.16,2.41-5.36,5.57-5.27"/>
        <path d="M228.6,233.64c-3.22,.05-5.47-2.12-5.46-5.29,.01-3.16,2.31-5.47,5.4-5.42,3.02,.04,5.15,2.14,5.25,5.17,.11,3.24-2,5.49-5.19,5.55"/>
        <path d="M269,73.44l-15.71,18.89c-.65,3.23,9.22,13.71,11.28,18.38,19.42,44.07-20.94,92.18-67.52,76.39-8.23-2.79-13.68-8.39-21-10.62l-16.2,17.62-17.99-17.6c-59.39,44.69-122.28-29.29-75.37-84.17l-15.79-18.89h39.94c1.03,0,14.04-9.44,17.44-10.96,31.08-13.92,68.01-14.14,99.45-1.21,4.59,1.88,20.31,12.17,21.55,12.17h39.93Zm-71,3.58c-24.98-9.47-53.52-10.04-78.08,.85,19.53,9.76,34.95,25.26,39.93,47.06,5.62-24.18,16.88-31.75,35.88-43.96,1.73-1.11,3.17,.19,2.28-3.95m-55.88,57.5c0-20.6-16.7-37.31-37.31-37.31s-37.3,16.7-37.3,37.31,16.7,37.31,37.3,37.31,37.31-16.7,37.31-37.31m109.87-.04c0-20.63-16.72-37.35-37.35-37.35s-37.35,16.72-37.35,37.35,16.72,37.35,37.35,37.35,37.35-16.72,37.35-37.35"/>
        <path d="M225.06,133.2c0,10.71-8.68,19.39-19.38,19.39s-19.39-8.68-19.39-19.39,8.68-19.38,19.39-19.38,19.38,8.68,19.38,19.38"/>
        <path d="M114.97,133.22c0,10.73-8.7,19.43-19.43,19.43s-19.43-8.7-19.43-19.43,8.7-19.43,19.43-19.43,19.43,8.7,19.43,19.43"/>
      </svg>
    `,
    google: '<img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" alt="Google Logo" style="width:100%; height:100%; object-fit:contain;">',
    facebook: `
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#1877F2">
        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.296h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
      </svg>
    `
  };
}

// Función para simular fetch de reseñas
async function fetchReviews(source) {
  return new Promise(resolve => {
    setTimeout(() => {
      resolve(reviewsData[source] || []);
    }, 100);
  });
}

// Función para renderizar las reseñas
async function renderReviews(source) {
  const container = document.getElementById("reviews-container");
  if (!container) return;

  try {
    const reviews = await fetchReviews(source);
    const logos = getLogos();
    
    container.innerHTML = ""; // Limpiar contenedor

    if (reviews.length === 0) {
      container.innerHTML = '<p class="text-center text-gray-600 col-span-full">No hay reseñas disponibles para esta fuente.</p>';
      return;
    }

    // Agregar logo correspondiente a cada reseña
    const reviewsWithLogos = reviews.map(review => ({
      ...review,
      logo: logos[source] || logos.tripadvisor
    }));

    container.innerHTML = reviewsWithLogos
      .map((review, index) => createReviewCard(review, index))
      .join("");

    // Agregar event listeners para "Read more"
    container.querySelectorAll('.read-more-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const fullText = decodeURIComponent(e.target.dataset.fullText);
        const textContentElement = e.target.closest('.review-text-content');
        if (textContentElement) {
          textContentElement.innerHTML = fullText;
        }
      });
    });

  } catch (error) {
    console.error("Error al cargar las reseñas:", error);
    container.innerHTML = '<p class="text-center text-red-500 col-span-full">Error al cargar las reseñas. Intenta nuevamente.</p>';
  }
}

// Función principal de inicialización
export function initReviews() {
  const reviewSources = document.querySelectorAll(".review-source");
  
  // Event listeners para las fuentes
  reviewSources.forEach((sourceElement) => {
    sourceElement.addEventListener("click", () => {
      reviewSources.forEach((s) => s.classList.remove("active"));
      sourceElement.classList.add("active");
      renderReviews(sourceElement.dataset.source);
    });
  });

  // Cargar reseñas iniciales de TripAdvisor
  renderReviews("tripadvisor");
}